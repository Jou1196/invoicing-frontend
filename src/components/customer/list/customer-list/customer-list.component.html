<p-toast></p-toast>
<div class="card">
    <h2>Listado de Clientes</h2>

    <div class="p-d-flex p-jc-between p-ai-center p-mb-3">
        <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input 
                pInputText 
                type="text" 
                [(ngModel)]="searchKeyword" 
                (ngModelChange)="onSearch()"
                placeholder="Buscar por Nombre o Documento"
            />
        </span>
        <p-button 
        label="Nuevo Cliente" 
        icon="pi pi-plus" 
        severity="info"
        [raised]="true"
        (click)="openNew()"
    ></p-button>
    </div>
    

    <p-table 
        [value]="customers" 
        [loading]="loading"
        [paginator]="true" 
        [rows]="rowsPerPage" 
        [totalRecords]="totalRecords"
        [lazy]="true"
        (onLazyLoad)="onPageChange($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} clientes"
    >
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 5%">ID</th>
                <th>Nombre</th>
                <th>Documento</th>
                <th>Email</th>
                <th>Dirección</th>
                <th style="width: 10%">Acciones</th> </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-customer>
            <tr>
                <td>{{ customer.id }}</td>
                <td>{{ customer.name }}</td>
                <td>{{ customer.docNumber }}</td>
                <td>{{ customer.email }}</td>
                <td>{{ customer.address }}</td>
                <td>
                    <p-button 
                        icon="pi pi-pencil" 
                        styleClass="p-button-sm p-button-warning" 
                        [ngStyle]="{'margin-right': '8px'}" 
                        (click)="editCustomer(customer)"
                    ></p-button>

                    <p-button 
                        icon="pi pi-trash" 
                        styleClass="p-button-sm p-button-danger" 
                        (click)="deleteCustomer(customer.id!)"
                    ></p-button>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr *ngIf="!loading">
                <td colspan="6" style="text-align: center;">{{ searchKeyword ? 'No se encontraron resultados para la búsqueda.' : 'No se encontraron clientes en la base de datos.' }}</td>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="loadingbody">
            <tr>
                <td colspan="6" style="text-align: center;">Cargando clientes. Por favor, espere.</td>
            </tr>
        </ng-template>

    </p-table>
</div>

<p-dialog 
    [(visible)]="displayDialog"             [header]="customerDialogHeader"         [modal]="true"                          [style]="{width: '500px'}"              [closable]="true"                       [draggable]="false"                     [resizable]="false"                     >
    <div class="p-fluid dialog-content" *ngIf="selectedCustomer">
        
        <div class="p-field p-mb-4">
            <label for="name">Nombre</label>
            <input id="name" type="text" pInputText [(ngModel)]="selectedCustomer.name" required autofocus>
        </div>
        
        <div class="p-field p-mb-4">
            <label for="docNumber">Documento</label>
            <input id="docNumber" type="text" pInputText [(ngModel)]="selectedCustomer.docNumber" required>
        </div>
        
        <div class="p-field p-mb-4">
            <label for="email">Email</label>
            <input id="email" type="email" pInputText [(ngModel)]="selectedCustomer.email">
        </div>
        
        <div class="p-field p-mb-4">
            <label for="address">Dirección</label>
            <textarea id="address" pInputTextarea [(ngModel)]="selectedCustomer.address" rows="3"></textarea>
        </div>
        
    </div>
    
    <ng-template pTemplate="footer">
        <div class="p-d-flex p-jc-end">
            <p-button 
                label="Cancelar" 
                (onClick)="displayDialog=false" 
                styleClass="p-button-text p-button-secondary p-mr-2"
            ></p-button>
            
            <p-button 
                label="Guardar" 
                icon="pi pi-check" 
                (onClick)="saveCustomer()" 
                styleClass="p-button-success"
                [disabled]="!selectedCustomer?.name || !selectedCustomer?.docNumber"
            ></p-button>
        </div>
    </ng-template>

</p-dialog>